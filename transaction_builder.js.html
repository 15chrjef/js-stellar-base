<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>transaction_builder.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Account.html">Account</a><ul class='methods'><li data-type='method'><a href="Account.html#.isValidAccountId">isValidAccountId</a></li><li data-type='method'><a href="Account.html#.isValidAddress">isValidAddress</a></li><li data-type='method'><a href="Account.html#accountId">accountId</a></li><li data-type='method'><a href="Account.html#getAddress">getAddress</a></li><li data-type='method'><a href="Account.html#getSequenceNumber">getSequenceNumber</a></li><li data-type='method'><a href="Account.html#sequenceNumber">sequenceNumber</a></li></ul></li><li><a href="Asset.html">Asset</a><ul class='methods'><li data-type='method'><a href="Asset.html#.fromOperation">fromOperation</a></li><li data-type='method'><a href="Asset.html#.native">native</a></li><li data-type='method'><a href="Asset.html#equals">equals</a></li><li data-type='method'><a href="Asset.html#getAssetType">getAssetType</a></li><li data-type='method'><a href="Asset.html#getCode">getCode</a></li><li data-type='method'><a href="Asset.html#getIssuer">getIssuer</a></li><li data-type='method'><a href="Asset.html#isNative">isNative</a></li><li data-type='method'><a href="Asset.html#toXdrObject">toXdrObject</a></li></ul></li><li><a href="Keypair.html">Keypair</a><ul class='methods'><li data-type='method'><a href="Keypair.html#.fromAccountId">fromAccountId</a></li><li data-type='method'><a href="Keypair.html#.fromAddress">fromAddress</a></li><li data-type='method'><a href="Keypair.html#.fromBase58Seed">fromBase58Seed</a></li><li data-type='method'><a href="Keypair.html#.fromRawSeed">fromRawSeed</a></li><li data-type='method'><a href="Keypair.html#.fromSeed">fromSeed</a></li><li data-type='method'><a href="Keypair.html#.master">master</a></li><li data-type='method'><a href="Keypair.html#.random">random</a></li><li data-type='method'><a href="Keypair.html#accountId">accountId</a></li><li data-type='method'><a href="Keypair.html#address">address</a></li><li data-type='method'><a href="Keypair.html#canSign">canSign</a></li><li data-type='method'><a href="Keypair.html#rawPublicKey">rawPublicKey</a></li><li data-type='method'><a href="Keypair.html#rawSecretKey">rawSecretKey</a></li><li data-type='method'><a href="Keypair.html#rawSeed">rawSeed</a></li><li data-type='method'><a href="Keypair.html#seed">seed</a></li><li data-type='method'><a href="Keypair.html#sign">sign</a></li><li data-type='method'><a href="Keypair.html#verify">verify</a></li></ul></li><li><a href="Memo.html">Memo</a><ul class='methods'><li data-type='method'><a href="Memo.html#.hash">hash</a></li><li data-type='method'><a href="Memo.html#.id">id</a></li><li data-type='method'><a href="Memo.html#.none">none</a></li><li data-type='method'><a href="Memo.html#.returnHash">returnHash</a></li><li data-type='method'><a href="Memo.html#.text">text</a></li></ul></li><li><a href="Network.html">Network</a><ul class='methods'><li data-type='method'><a href="Network.html#.current">current</a></li><li data-type='method'><a href="Network.html#.use">use</a></li><li data-type='method'><a href="Network.html#.useDefault">useDefault</a></li><li data-type='method'><a href="Network.html#.usePublicNet">usePublicNet</a></li><li data-type='method'><a href="Network.html#.usePublicNetwork">usePublicNetwork</a></li><li data-type='method'><a href="Network.html#.useTestNet">useTestNet</a></li><li data-type='method'><a href="Network.html#.useTestNetwork">useTestNetwork</a></li><li data-type='method'><a href="Network.html#networkId">networkId</a></li><li data-type='method'><a href="Network.html#networkPassphrase">networkPassphrase</a></li></ul></li><li><a href="Operation.html">Operation</a><ul class='methods'><li data-type='method'><a href="Operation.html#.accountMerge">accountMerge</a></li><li data-type='method'><a href="Operation.html#.allowTrust">allowTrust</a></li><li data-type='method'><a href="Operation.html#.changeTrust">changeTrust</a></li><li data-type='method'><a href="Operation.html#.createAccount">createAccount</a></li><li data-type='method'><a href="Operation.html#.createPassiveOffer">createPassiveOffer</a></li><li data-type='method'><a href="Operation.html#.inflation">inflation</a></li><li data-type='method'><a href="Operation.html#.manageOffer">manageOffer</a></li><li data-type='method'><a href="Operation.html#.operationToObject">operationToObject</a></li><li data-type='method'><a href="Operation.html#.pathPayment">pathPayment</a></li><li data-type='method'><a href="Operation.html#.payment">payment</a></li><li data-type='method'><a href="Operation.html#.setOptions">setOptions</a></li></ul></li><li><a href="Transaction.html">Transaction</a><ul class='methods'><li data-type='method'><a href="Transaction.html#hash">hash</a></li><li data-type='method'><a href="Transaction.html#sign">sign</a></li><li data-type='method'><a href="Transaction.html#signatureBase">signatureBase</a></li><li data-type='method'><a href="Transaction.html#toEnvelope">toEnvelope</a></li></ul></li><li><a href="TransactionBuilder.html">TransactionBuilder</a><ul class='methods'><li data-type='method'><a href="TransactionBuilder.html#addMemo">addMemo</a></li><li data-type='method'><a href="TransactionBuilder.html#addOperation">addOperation</a></li><li data-type='method'><a href="TransactionBuilder.html#addSigner">addSigner</a></li><li data-type='method'><a href="TransactionBuilder.html#build">build</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#Networks">Networks</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">transaction_builder.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {default as xdr} from "./generated/stellar-xdr_generated";
import {hash} from "./hashing";
import {Keypair} from "./keypair";
import {Account} from "./account";
import {Operation} from "./operation";
import {Transaction} from "./transaction";
import {Memo} from "./memo";
import {map} from "lodash";

let BASE_FEE     = 100; // Stroops
let MIN_LEDGER   = 0;
let MAX_LEDGER   = 0xFFFFFFFF; // max uint32

export class TransactionBuilder {

    /**
     * &lt;p>Transaction builder helps constructs a new `{@link Transaction}` using the given {@link Account}
     * as the transaction's "source account". The transaction will use the current sequence
     * number of the given account as its sequence number and increment the given account's
     * sequence number by one. The given source account must include a private key for signing
     * the transaction or an error will be thrown.&lt;/p>
     *
     * &lt;p>Operations can be added to the transaction via their corresponding builder methods, and
     * each returns the TransactionBuilder object so they can be chained together. After adding
     * the desired operations, call the `build()` method on the `TransactionBuilder` to return a fully
     * constructed `{@link Transaction}` that can be signed. The returned transaction will contain the
     * sequence number of the source account and include the signature from the source account.&lt;/p>
     *
     * &lt;p>The following code example creates a new transaction with {@link Operation.createAccount} and
     * {@link Operation.payment} operations.
     * The Transaction's source account first funds `destinationA`, then sends
     * a payment to `destinationB`. The built transaction is then signed by `sourceKeypair`.&lt;/p>
     *
     * ```
     * var transaction = new TransactionBuilder(source)
     *   .addOperation(Operation.createAccount({
            destination: destinationA,
            startingBalance: "20"
        }) // &lt;- funds and creates destinationA
        .addOperation(Operation.payment({
            destination: destinationB,
            amount: "100"
            asset: Asset.native()
        }) // &lt;- sends 100 XLM to destinationB
     *   .build();
     *
     * transaction.sign(sourceKeypair);
     * ```
     * @constructor
     * @param {Account} sourceAccount - The source account for this transaction.
     * @param {object} [opts]
     * @param {number} [opts.fee] - The max fee willing to pay per operation in this transaction (**in stroops**).
     * @param {object} [opts.timebounds] - The timebounds for the validity of this transaction.
     * @param {string} [opts.timebounds.minTime] - 64 bit unix timestamp
     * @param {string} [opts.timebounds.maxTime] - 64 bit unix timestamp
     * @param {Memo} [opts.memo] - The memo for the transaction
     */
    constructor(sourceAccount, opts={}) {
        if (!sourceAccount) {
            throw new Error("must specify source account for the transaction");
        }
        this.source        = sourceAccount;
        this.operations    = [];
        this.signers       = [];

        this.baseFee    = opts.fee || BASE_FEE;
        this.timebounds = opts.timebounds;

        this.memo       = opts.memo || Memo.none();

        // the signed base64 form of the transaction to be sent to Horizon
        this.blob = null;
    }

    /**
     * Adds an operation to the transaction.
     * @param {xdr.Operation} operation The xdr operation object, use {@link Operation} static methods.
     * @returns {TransactionBuilder}
     */
    addOperation(operation) {
        this.operations.push(operation);
        return this;
    }

    /**
     * Adds a memo to the transaction.
     * @param {xdr.Memo} memo The xdr memo object, use {@link Memo} static methods.
     * @returns {TransactionBuilder}
     */
    addMemo(memo) {
        this.memo = memo;
        return this;
    }

    /**
     * Adds the given signer's signature to the transaction.
     * @deprecated Use {@link Transaction#sign}
     * @returns {TransactionBuilder}
     */
    addSigner(keypair) {
        this.signers.push(keypair);
        return this;
    }

    /**
     * This will build the transaction and sign it with the {@link Keypair} passed to {@link TransactionBuilder#addSigner}.
     * It will also increment the source account's sequence number by 1.
     * @returns {Transaction} This method will return the built {@link Transaction}.
     */
    build() {
        var attrs = {
          sourceAccount: Keypair.fromAccountId(this.source.accountId()).xdrAccountId(),
          fee:           this.baseFee * this.operations.length,
          seqNum:        xdr.SequenceNumber.fromString(String(Number(this.source.sequence) + 1)),
          memo:          this.memo,
          ext:           new xdr.TransactionExt(0),
        };
        if (this.timebounds) {
            attrs.timeBounds = new xdr.TimeBounds(this.timebounds);
        }
        let xtx = new xdr.Transaction(attrs);
        xtx.operations(this.operations);
        let xenv = new xdr.TransactionEnvelope({tx:xtx});

        let tx = new Transaction(xenv);
        tx.sign(...this.signers);

        this.source.sequence = this.source.sequence + 1;
        return tx;
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jan 04 2016 16:24:19 GMT+0000 (UTC) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
